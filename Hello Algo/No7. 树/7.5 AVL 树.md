åœ¨â€œäºŒå‰æœç´¢æ ‘â€ç« èŠ‚ä¸­æˆ‘ä»¬æåˆ°ï¼Œåœ¨å¤šæ¬¡æ’å…¥å’Œåˆ é™¤æ“ä½œåï¼ŒäºŒå‰æœç´¢æ ‘å¯èƒ½é€€åŒ–ä¸ºé“¾è¡¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å°†ä»Â ğ‘‚(logâ¡ğ‘›)Â åŠ£åŒ–ä¸ºÂ ğ‘‚(ğ‘›)Â ã€‚

åœ¨éœ€è¦é¢‘ç¹è¿›è¡Œå¢åˆ æŸ¥æ”¹æ“ä½œçš„åœºæ™¯ä¸­ï¼ŒAVL æ ‘èƒ½å§‹ç»ˆä¿æŒé«˜æ•ˆçš„æ•°æ®æ“ä½œæ€§èƒ½ï¼Œå…·æœ‰å¾ˆå¥½çš„åº”ç”¨ä»·å€¼ã€‚

## 7.5.1 AVL æ ‘å¸¸è§æœ¯è¯­
AVL æ ‘æ—¢æ˜¯äºŒå‰æœç´¢æ ‘ï¼Œä¹Ÿæ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼ŒåŒæ—¶æ»¡è¶³è¿™ä¸¤ç±»äºŒå‰æ ‘çš„æ‰€æœ‰æ€§è´¨ï¼Œå› æ­¤æ˜¯ä¸€ç§å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆbalanced binary search treeï¼‰ã€‚

### 1. èŠ‚ç‚¹é«˜åº¦
ç”±äº AVL æ ‘çš„ç›¸å…³æ“ä½œéœ€è¦è·å–èŠ‚ç‚¹é«˜åº¦ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸ºèŠ‚ç‚¹ç±»æ·»åŠ Â `height`Â å˜é‡ï¼š
```python
class TreeNode:
	"""AVL æ ‘èŠ‚ç‚¹ç±»"""
	def __init__(self, val: int):
	    self.val: int = val                 # èŠ‚ç‚¹å€¼
	    self.height: int = 0                # èŠ‚ç‚¹é«˜åº¦
	    self.left: TreeNode | None = None   # å·¦å­èŠ‚ç‚¹å¼•ç”¨
	    self.right: TreeNode | None = None  # å³å­èŠ‚ç‚¹å¼•ç”¨
```
â€œèŠ‚ç‚¹é«˜åº¦â€æ˜¯æŒ‡ä»è¯¥èŠ‚ç‚¹åˆ°å®ƒçš„æœ€è¿œå¶èŠ‚ç‚¹çš„è·ç¦»ï¼Œå³æ‰€ç»è¿‡çš„â€œè¾¹â€çš„æ•°é‡ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå¶èŠ‚ç‚¹çš„é«˜åº¦ä¸ºÂ 0Â ï¼Œè€Œç©ºèŠ‚ç‚¹çš„é«˜åº¦ä¸ºÂ âˆ’1Â ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªå·¥å…·å‡½æ•°ï¼Œåˆ†åˆ«ç”¨äºè·å–å’Œæ›´æ–°èŠ‚ç‚¹çš„é«˜åº¦ï¼š
```python
def height(self, node: TreeNode | None) -> int:
    """è·å–èŠ‚ç‚¹é«˜åº¦"""
    # ç©ºèŠ‚ç‚¹é«˜åº¦ä¸º -1 ï¼Œå¶èŠ‚ç‚¹é«˜åº¦ä¸º 0
    if node is not None:
        return node.height
    return -1

def update_height(self, node: TreeNode | None):
    """æ›´æ–°èŠ‚ç‚¹é«˜åº¦"""
    # èŠ‚ç‚¹é«˜åº¦ç­‰äºæœ€é«˜å­æ ‘é«˜åº¦ + 1
    node.height = max([self.height(node.left), self.height(node.right)]) + 1
```
### 2. èŠ‚ç‚¹å¹³è¡¡å› å­
èŠ‚ç‚¹çš„å¹³è¡¡å› å­ï¼ˆbalance factorï¼‰å®šä¹‰ä¸ºèŠ‚ç‚¹å·¦å­æ ‘çš„é«˜åº¦å‡å»å³å­æ ‘çš„é«˜åº¦ï¼ŒåŒæ—¶è§„å®šç©ºèŠ‚ç‚¹çš„å¹³è¡¡å› å­ä¸ºÂ 0Â ã€‚æˆ‘ä»¬åŒæ ·å°†è·å–èŠ‚ç‚¹å¹³è¡¡å› å­çš„åŠŸèƒ½å°è£…æˆå‡½æ•°ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ï¼š
```python
def balance_factor(self, node: TreeNode | None) -> int:
	"""è·å–å¹³è¡¡å› å­"""
	# ç©ºèŠ‚ç‚¹å¹³è¡¡å› å­ä¸º 0
	if node is None:
	    return 0
	# èŠ‚ç‚¹å¹³è¡¡å› å­ = å·¦å­æ ‘é«˜åº¦ - å³å­æ ‘é«˜åº¦
	return self.height(node.left) - self.height(node.right)
```

## 7.5.2 AVL æ ‘æ—‹è½¬
AVL æ ‘çš„ç‰¹ç‚¹åœ¨äºâ€œæ—‹è½¬â€æ“ä½œï¼Œå®ƒèƒ½å¤Ÿåœ¨ä¸å½±å“äºŒå‰æ ‘çš„ä¸­åºéå†åºåˆ—çš„å‰æä¸‹ï¼Œä½¿å¤±è¡¡èŠ‚ç‚¹é‡æ–°æ¢å¤å¹³è¡¡ã€‚æ¢å¥è¯è¯´ï¼Œ**æ—‹è½¬æ“ä½œæ—¢èƒ½ä¿æŒâ€œäºŒå‰æœç´¢æ ‘â€çš„æ€§è´¨ï¼Œä¹Ÿèƒ½ä½¿æ ‘é‡æ–°å˜ä¸ºâ€œå¹³è¡¡äºŒå‰æ ‘â€**ã€‚
æˆ‘ä»¬å°†å¹³è¡¡å› å­ç»å¯¹å€¼Â >1Â çš„èŠ‚ç‚¹ç§°ä¸ºâ€œå¤±è¡¡èŠ‚ç‚¹â€ã€‚æ ¹æ®èŠ‚ç‚¹å¤±è¡¡æƒ…å†µçš„ä¸åŒï¼Œæ—‹è½¬æ“ä½œåˆ†ä¸ºå››ç§ï¼šå³æ—‹ã€å·¦æ—‹ã€å…ˆå³æ—‹åå·¦æ—‹ã€å…ˆå·¦æ—‹åå³æ—‹ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»è¿™äº›æ—‹è½¬æ“ä½œã€‚
### 1. å³æ—‹
ä¸‹å›¾æ‰€ç¤ºï¼ŒèŠ‚ç‚¹ä¸‹æ–¹ä¸ºå¹³è¡¡å› å­ã€‚ä»åº•è‡³é¡¶çœ‹ï¼ŒäºŒå‰æ ‘ä¸­é¦–ä¸ªå¤±è¡¡èŠ‚ç‚¹æ˜¯â€œèŠ‚ç‚¹ 3â€ã€‚æˆ‘ä»¬å…³æ³¨ä»¥è¯¥å¤±è¡¡èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘ï¼Œå°†è¯¥èŠ‚ç‚¹è®°ä¸ºÂ `node`Â ï¼Œå…¶å·¦å­èŠ‚ç‚¹è®°ä¸ºÂ `child`Â ï¼Œæ‰§è¡Œâ€œå³æ—‹â€æ“ä½œã€‚å®Œæˆå³æ—‹åï¼Œå­æ ‘æ¢å¤å¹³è¡¡ï¼Œå¹¶ä¸”ä»ç„¶ä¿æŒäºŒå‰æœç´¢æ ‘çš„æ€§è´¨ã€‚
![[Pasted image 20240603215042.png]]
![[Pasted image 20240603215050.png]]
![[Pasted image 20240603215058.png]]
![[Pasted image 20240603215104.png]]

å½“èŠ‚ç‚¹Â `child`Â æœ‰å³å­èŠ‚ç‚¹ï¼ˆè®°ä¸ºÂ `grand_child`Â ï¼‰æ—¶ï¼Œéœ€è¦åœ¨å³æ—‹ä¸­æ·»åŠ ä¸€æ­¥ï¼šå°†Â `grand_child`Â ä½œä¸ºÂ `node`Â çš„å·¦å­èŠ‚ç‚¹ã€‚
![[Pasted image 20240603215118.png]]
â€œå‘å³æ—‹è½¬â€æ˜¯ä¸€ç§å½¢è±¡åŒ–çš„è¯´æ³•ï¼Œå®é™…ä¸Šéœ€è¦é€šè¿‡ä¿®æ”¹èŠ‚ç‚¹æŒ‡é’ˆæ¥å®ç°ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š
```python
def right_rotate(self, node: TreeNode | None) -> TreeNode | None:
	"""å³æ—‹æ“ä½œ"""
	child = node.left
	grand_child = child.right
	# ä»¥ child ä¸ºåŸç‚¹ï¼Œå°† node å‘å³æ—‹è½¬
	child.right = node
	node.left = grand_child
	# æ›´æ–°èŠ‚ç‚¹é«˜åº¦
	self.update_height(node)
	self.update_height(child)
	# è¿”å›æ—‹è½¬åå­æ ‘çš„æ ¹èŠ‚ç‚¹
	return child
```

### 2. å·¦æ—‹
ç›¸åº”åœ°ï¼Œå¦‚æœè€ƒè™‘ä¸Šè¿°å¤±è¡¡äºŒå‰æ ‘çš„â€œé•œåƒâ€ï¼Œåˆ™éœ€è¦æ‰§è¡Œä¸‹å›¾æ‰€ç¤ºçš„â€œå·¦æ—‹â€æ“ä½œã€‚
![[Pasted image 20240603215156.png]]
åŒç†ï¼Œå½“èŠ‚ç‚¹Â `child`Â æœ‰å·¦å­èŠ‚ç‚¹ï¼ˆè®°ä¸ºÂ `grand_child`Â ï¼‰æ—¶ï¼Œéœ€è¦åœ¨å·¦æ—‹ä¸­æ·»åŠ ä¸€æ­¥ï¼šå°†Â `grand_child`Â ä½œä¸ºÂ `node`Â çš„å³å­èŠ‚ç‚¹ã€‚
![[Pasted image 20240603215209.png]]
å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œ**å³æ—‹å’Œå·¦æ—‹æ“ä½œåœ¨é€»è¾‘ä¸Šæ˜¯é•œåƒå¯¹ç§°çš„ï¼Œå®ƒä»¬åˆ†åˆ«è§£å†³çš„ä¸¤ç§å¤±è¡¡æƒ…å†µä¹Ÿæ˜¯å¯¹ç§°çš„**ã€‚åŸºäºå¯¹ç§°æ€§ï¼Œæˆ‘ä»¬åªéœ€å°†å³æ—‹çš„å®ç°ä»£ç ä¸­çš„æ‰€æœ‰çš„Â `left`Â æ›¿æ¢ä¸ºÂ `right`Â ï¼Œå°†æ‰€æœ‰çš„Â `right`Â æ›¿æ¢ä¸ºÂ `left`Â ï¼Œå³å¯å¾—åˆ°å·¦æ—‹çš„å®ç°ä»£ç ï¼š
```python
def left_rotate(self, node: TreeNode | None) -> TreeNode | None:
	"""å·¦æ—‹æ“ä½œ"""
	child = node.right
	grand_child = child.left
	# ä»¥ child ä¸ºåŸç‚¹ï¼Œå°† node å‘å·¦æ—‹è½¬
	child.left = node
	node.right = grand_child
	# æ›´æ–°èŠ‚ç‚¹é«˜åº¦
	self.update_height(node)
	self.update_height(child)
	# è¿”å›æ—‹è½¬åå­æ ‘çš„æ ¹èŠ‚ç‚¹
	return child
```

### 3. å…ˆå·¦æ—‹åå³æ—‹
å¯¹äºä¸‹å›¾ä¸­çš„å¤±è¡¡èŠ‚ç‚¹ 3 ï¼Œä»…ä½¿ç”¨å·¦æ—‹æˆ–å³æ—‹éƒ½æ— æ³•ä½¿å­æ ‘æ¢å¤å¹³è¡¡ã€‚æ­¤æ—¶éœ€è¦å…ˆå¯¹Â `child`Â æ‰§è¡Œâ€œå·¦æ—‹â€ï¼Œå†å¯¹Â `node`Â æ‰§è¡Œâ€œå³æ—‹â€ã€‚
![[Pasted image 20240603215253.png]]

### 4.  å…ˆå³æ—‹åå·¦æ—‹
å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºä¸Šè¿°å¤±è¡¡äºŒå‰æ ‘çš„é•œåƒæƒ…å†µï¼Œéœ€è¦å…ˆå¯¹Â `child`Â æ‰§è¡Œâ€œå³æ—‹â€ï¼Œå†å¯¹Â `node`Â æ‰§è¡Œâ€œå·¦æ—‹â€ã€‚
