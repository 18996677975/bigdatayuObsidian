è¯»å®Œæœ¬æ–‡ï¼Œä½ ä¸ä»…å­¦ä¼šäº†ç®—æ³•å¥—è·¯ï¼Œè¿˜å¯ä»¥é¡ºä¾¿è§£å†³å¦‚ä¸‹é¢˜ç›®ï¼š

|LeetCode|åŠ›æ‰£|éš¾åº¦|
|---|---|---|
|[652. Find Duplicate Subtrees](https://leetcode.com/problems/find-duplicate-subtrees/)|[652. å¯»æ‰¾é‡å¤çš„å­æ ‘](https://leetcode.cn/problems/find-duplicate-subtrees/)|ğŸŸ |

æœ¬æ–‡æ˜¯æ‰¿æ¥Â [ä¸œå“¥å¸¦ä½ åˆ·äºŒå‰æ ‘ï¼ˆçº²é¢†ç¯‡ï¼‰](https://labuladong.online/algo/essential-technique/binary-tree-summary/)Â çš„ç¬¬å››ç¯‡æ–‡ç« ï¼Œä¸»è¦è®²äºŒå‰æ ‘ååºä½ç½®çš„å¦™ç”¨ï¼Œå¤è¿°ä¸‹å‰æ–‡å…³äºååºéå†çš„æè¿°ï¼š

> å‰åºä½ç½®çš„ä»£ç åªèƒ½ä»å‡½æ•°å‚æ•°ä¸­è·å–çˆ¶èŠ‚ç‚¹ä¼ é€’æ¥çš„æ•°æ®ï¼Œè€Œååºä½ç½®çš„ä»£ç ä¸ä»…å¯ä»¥è·å–å‚æ•°æ•°æ®ï¼Œè¿˜å¯ä»¥è·å–åˆ°å­æ ‘é€šè¿‡å‡½æ•°è¿”å›å€¼ä¼ é€’å›æ¥çš„æ•°æ®ã€‚
> 
> **é‚£ä¹ˆæ¢å¥è¯è¯´ï¼Œä¸€æ—¦ä½ å‘ç°é¢˜ç›®å’Œå­æ ‘æœ‰å…³ï¼Œé‚£å¤§æ¦‚ç‡è¦ç»™å‡½æ•°è®¾ç½®åˆç†çš„å®šä¹‰å’Œè¿”å›å€¼ï¼Œåœ¨ååºä½ç½®å†™ä»£ç äº†**ã€‚

å¤šè¯´æ— ç›Šï¼Œæˆ‘ä»¬ç›´æ¥çœ‹é¢˜ï¼Œè¿™æ˜¯åŠ›æ‰£ç¬¬ 652 é¢˜ã€Œ [å¯»æ‰¾é‡å¤çš„å­æ ‘](https://leetcode.cn/problems/find-duplicate-subtrees/) ã€ï¼š

```ad-question
title: 652. å¯»æ‰¾é‡å¤çš„å­æ ‘
collapse: closed
ç»™ä½ ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹Â `root`Â ï¼Œè¿”å›æ‰€æœ‰Â **é‡å¤çš„å­æ ‘**Â ã€‚

å¯¹äºåŒä¸€ç±»çš„é‡å¤å­æ ‘ï¼Œä½ åªéœ€è¦è¿”å›å…¶ä¸­ä»»æ„Â **ä¸€æ£µ**Â çš„æ ¹ç»“ç‚¹å³å¯ã€‚

å¦‚æœä¸¤æ£µæ ‘å…·æœ‰Â **ç›¸åŒçš„ç»“æ„**Â å’ŒÂ **ç›¸åŒçš„ç»“ç‚¹å€¼**Â ï¼Œåˆ™è®¤ä¸ºäºŒè€…æ˜¯Â **é‡å¤**Â çš„ã€‚

**ç¤ºä¾‹ 1ï¼š**
![[Pasted image 20240704151616.png]]
**è¾“å…¥ï¼š**root = \[1,2,3,4,null,2,4,null,null,4]
**è¾“å‡ºï¼š**\[\[2,4],\[4]]

**ç¤ºä¾‹ 2ï¼š**
![[Pasted image 20240704151708.png]]
**è¾“å…¥ï¼š**root = \[2,1,1]
**è¾“å‡ºï¼š**\[\[1]]

**ç¤ºä¾‹ 3ï¼š**
![[Pasted image 20240704151716.png]]
**è¾“å…¥ï¼š**root = \[2,2,2,3,null,3,null]
**è¾“å‡ºï¼š**\[\[2,3],\[3]]

**æç¤ºï¼š**

- æ ‘ä¸­çš„ç»“ç‚¹æ•°åœ¨Â `[1, 5000]`Â èŒƒå›´å†…ã€‚
- `-200 <= Node.val <= 200`

```

ç®€å•è§£é‡Šä¸‹é¢˜ç›®ï¼Œè¾“å…¥æ˜¯ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹Â `root`ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢è£…ç€è‹¥å¹²ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹å¯¹åº”çš„å­æ ‘åœ¨åŸäºŒå‰æ ‘ä¸­æ˜¯å­˜åœ¨é‡å¤çš„ã€‚

è¯´èµ·æ¥æ¯”è¾ƒç»•ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œæ¯”å¦‚è¾“å…¥å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š
![[Pasted image 20240704171223.png]]
é¦–å…ˆï¼ŒèŠ‚ç‚¹ 4 æœ¬èº«å¯ä»¥ä½œä¸ºä¸€æ£µå­æ ‘ï¼Œä¸”äºŒå‰æ ‘ä¸­æœ‰å¤šä¸ªèŠ‚ç‚¹ 4ï¼š
![[Pasted image 20240704171232.png]]
ç±»ä¼¼çš„ï¼Œè¿˜å­˜åœ¨ä¸¤æ£µä»¥ 2 ä¸ºæ ¹çš„é‡å¤å­æ ‘ï¼š
![[Pasted image 20240704171240.png]]
é‚£ä¹ˆï¼Œæˆ‘ä»¬è¿”å›çš„Â `List`Â ä¸­å°±åº”è¯¥æœ‰ä¸¤ä¸ªÂ `TreeNode`ï¼Œå€¼åˆ†åˆ«ä¸º 4 å’Œ 2ï¼ˆå…·ä½“æ˜¯å“ªä¸ªèŠ‚ç‚¹éƒ½æ— æ‰€è°“ï¼‰ã€‚

è¿™é¢˜å’‹åšå‘¢ï¼Ÿ**è¿˜æ˜¯è€å¥—è·¯ï¼Œå…ˆæ€è€ƒï¼Œå¯¹äºæŸä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒåº”è¯¥åšä»€ä¹ˆ**ã€‚

æ¯”å¦‚è¯´ï¼Œä½ ç«™åœ¨å›¾ä¸­è¿™ä¸ªèŠ‚ç‚¹ 2 ä¸Šï¼š
![[Pasted image 20240704171258.png]]

å¦‚æœä½ æƒ³çŸ¥é“ä»¥è‡ªå·±ä¸ºæ ¹çš„å­æ ‘æ˜¯ä¸æ˜¯é‡å¤çš„ï¼Œæ˜¯å¦åº”è¯¥è¢«åŠ å…¥ç»“æœåˆ—è¡¨ä¸­ï¼Œä½ éœ€è¦çŸ¥é“ä»€ä¹ˆä¿¡æ¯ï¼Ÿ

**ä½ éœ€è¦çŸ¥é“ä»¥ä¸‹ä¸¤ç‚¹**ï¼š

**1ã€ä»¥æˆ‘ä¸ºæ ¹çš„è¿™æ£µäºŒå‰æ ‘ï¼ˆå­æ ‘ï¼‰é•¿å•¥æ ·**ï¼Ÿ

**2ã€ä»¥å…¶ä»–èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘éƒ½é•¿å•¥æ ·**ï¼Ÿ

**é¦–å…ˆæ¥æ€è€ƒï¼Œæˆ‘å¦‚ä½•æ‰èƒ½çŸ¥é“ä»¥è‡ªå·±ä¸ºæ ¹çš„è¿™æ£µäºŒå‰æ ‘é•¿å•¥æ ·**ï¼Ÿ

å…¶å®æƒ³åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥åˆ¤æ–­æœ¬é¢˜éœ€è¦åœ¨äºŒå‰æ ‘çš„ååºä½ç½®å†™ä»£ç äº†ã€‚æ˜ç¡®äº†è¦ç”¨ååºéå†ï¼Œé‚£åº”è¯¥æ€ä¹ˆæè¿°ä¸€æ£µäºŒå‰æ ‘çš„æ¨¡æ ·å‘¢ï¼Ÿæˆ‘ä»¬åæ–‡Â [åºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æ ‘](https://labuladong.online/algo/data-structure/serialize-and-deserialize-binary-tree/)Â å…¶å®å†™è¿‡äº†ï¼ŒäºŒå‰æ ‘çš„å‰åº/ä¸­åº/ååº/å±‚åºéå†ç»“æœå¯ä»¥æè¿°äºŒå‰æ ‘çš„ç»“æ„ã€‚

é‚£ä¹ˆï¼Œæˆ‘å°±ä»¥ååºéå†ç»“æœä½œä¸ºåºåˆ—åŒ–ç»“æœå§ï¼Œå¯ä»¥é€šè¿‡æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼æŠŠäºŒå‰æ ‘åºåˆ—åŒ–ï¼Œçœ‹ä¸‹ä»£ç ï¼š
```python
def serialize(root):
    """
    å®šä¹‰ï¼šè¾“å…¥ä»¥ root ä¸ºæ ¹çš„äºŒå‰æ ‘ï¼Œè¿”å›è¿™æ£µæ ‘çš„åºåˆ—åŒ–å­—ç¬¦ä¸²
    :type root: TreeNode
    :rtype: str
    """
    # å¯¹äºç©ºèŠ‚ç‚¹ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦è¡¨ç¤º
    if not root:
        return "#"
    # å°†å·¦å³å­æ ‘åºåˆ—åŒ–æˆå­—ç¬¦ä¸²
    left = serialize(root.left)
    right = serialize(root.right)
    /* ååºéå†ä»£ç ä½ç½® */
    # å·¦å³å­æ ‘åŠ ä¸Šè‡ªå·±ï¼Œå°±æ˜¯ä»¥è‡ªå·±ä¸ºæ ¹çš„äºŒå‰æ ‘åºåˆ—åŒ–ç»“æœ
    myself = left + "," + right + "," + str(root.val)
    return myself
```

æˆ‘ä»¬ç”¨éæ•°å­—çš„ç‰¹æ®Šç¬¦Â `#`Â è¡¨ç¤ºç©ºæŒ‡é’ˆï¼Œå¹¶ä¸”ç”¨å­—ç¬¦Â `,`Â åˆ†éš”æ¯ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹å€¼ï¼Œè¿™å±äºåºåˆ—åŒ–äºŒå‰æ ‘çš„å¥—è·¯äº†ï¼Œä¸å¤šè¯´ã€‚

æ³¨æ„æˆ‘ä»¬Â `myself`Â æ˜¯æŒ‰ç…§å·¦å­æ ‘ã€å³å­æ ‘ã€æ ¹èŠ‚ç‚¹è¿™æ ·çš„é¡ºåºæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ååºéå†é¡ºåºã€‚å› ä¸ºæˆ‘ä»¬è¿™é‡Œçš„ç›®çš„æ˜¯é€šè¿‡åºåˆ—åŒ–å”¯ä¸€æè¿°ä¸€æ£µäºŒå‰æ ‘çš„ç»“æ„ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥ç”¨å‰åºé¡ºåºæ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½ç”¨ä¸­åºé¡ºåºã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªé—®é¢˜å°±è§£å†³äº†ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œé€’å½’å‡½æ•°ä¸­çš„Â `myself`Â å˜é‡å°±å¯ä»¥æè¿°ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„äºŒå‰æ ‘ã€‚

**ç°åœ¨æˆ‘ä»¬è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘çŸ¥é“äº†è‡ªå·±é•¿å•¥æ ·ï¼Œæ€ä¹ˆçŸ¥é“åˆ«äººé•¿å•¥æ ·**ï¼Ÿè¿™æ ·æˆ‘æ‰èƒ½çŸ¥é“æœ‰æ²¡æœ‰å…¶ä»–å­æ ‘è·Ÿæˆ‘é‡å¤å¯¹å§ã€‚

è¿™å¾ˆç®€å•å‘€ï¼Œæˆ‘ä»¬å€ŸåŠ©ä¸€ä¸ªå¤–éƒ¨æ•°æ®ç»“æ„ï¼Œè®©æ¯ä¸ªèŠ‚ç‚¹æŠŠè‡ªå·±å­æ ‘çš„åºåˆ—åŒ–ç»“æœå­˜è¿›å»ï¼Œè¿™æ ·ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œä¸å°±å¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰å…¶ä»–èŠ‚ç‚¹çš„å­æ ‘å’Œè‡ªå·±é‡å¤äº†ä¹ˆï¼Ÿ

åˆæ­¥æ€è·¯å¯ä»¥ä½¿ç”¨Â `HashSet`Â è®°å½•æ‰€æœ‰å­æ ‘çš„åºåˆ—åŒ–ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š
```python
from typing import List

# è®°å½•æ‰€æœ‰å­æ ‘
sub_trees = set()
# è®°å½•é‡å¤çš„å­æ ‘æ ¹èŠ‚ç‚¹
res = []

def serialize(root: TreeNode) -> str:
    if not root:
        return "#"

    # å·¦å³å­æ ‘çš„åºåˆ—åŒ–ç»“æœ
    left = serialize(root.left)
    right = serialize(root.right)

    # ååºä½ç½®ï¼Œè®¡ç®—ä»¥è‡ªå·±ä¸ºæ ¹çš„äºŒå‰æ ‘åºåˆ—åŒ–ç»“æœ
    myself = left + "," + right+ "," + str(root.val)
    if myself in sub_trees:
        # æœ‰äººå’Œæˆ‘é‡å¤ï¼ŒæŠŠè‡ªå·±åŠ å…¥ç»“æœåˆ—è¡¨
        res.append(root)
    else:
        # æš‚æ—¶æ²¡äººè·Ÿæˆ‘é‡å¤ï¼ŒæŠŠè‡ªå·±åŠ å…¥å­æ ‘é›†åˆ
        sub_trees.add(myself)
    return myself
```
ä½†æ˜¯å‘¢ï¼Œè¿™æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœå‡ºç°å¤šæ£µé‡å¤çš„å­æ ‘ï¼Œç»“æœé›†Â `res`Â ä¸­å¿…ç„¶å‡ºç°é‡å¤ï¼Œè€Œé¢˜ç›®è¦æ±‚ä¸å¸Œæœ›å‡ºç°é‡å¤ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥æŠŠÂ `HashSet`Â å‡çº§æˆÂ `HashMap`ï¼Œé¢å¤–è®°å½•æ¯æ£µå­æ ‘çš„å‡ºç°æ¬¡æ•°ï¼š
```python
class Solution:  
    def __init__(self):  
        # è®°å½•é‡å¤çš„å­æ ‘æ ¹èŠ‚ç‚¹  
        self.res = []  
        # è®°å½•æ‰€æœ‰å­æ ‘ä»¥åŠå‡ºç°çš„æ¬¡æ•°  
        self.subTree = {}  
  
    def findDuplicateSubtrees(self, root: Optional[TreeNode]) -> List[Optional[TreeNode]]:  
        self.traverse(root)  
        return self.res  
  
    def traverse(self, root: Optional[TreeNode]):  
        if not root:  
            return "#"  
  
        # å…ˆç®—å·¦å³å­æ ‘çš„åºåˆ—åŒ–ç»“æœ  
        left = self.traverse(root.left)  
        right = self.traverse(root.right)  
  
        tree = left + "," + right + "," + str(root.val)  
  
        times = self.subTree.get(tree, 0)  
        # å¤šæ¬¡é‡å¤ä¹Ÿåªä¼šè¢«åŠ å…¥ç»“æœé›†ä¸€æ¬¡  
        if times == 1:  
            self.res.append(root)  
        # ç»™å­æ ‘å¯¹åº”çš„å‡ºç°æ¬¡æ•°åŠ ä¸€  
        self.subTree[tree] = times + 1  
  
        return tree
```